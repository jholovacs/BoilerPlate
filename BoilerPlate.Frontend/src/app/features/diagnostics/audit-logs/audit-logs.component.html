<div class="container">
  <div class="header">
    <h1>Audit Logs</h1>
    <button class="btn btn-secondary" (click)="logout()">Logout</button>
  </div>

  <div class="card">
    <div class="toolbar">
      <div class="toolbar-left">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="search()"
          placeholder="Search by user, email, or event type..."
          class="search-input"
        />
        <input
          type="text"
          [(ngModel)]="eventTypeFilter"
          (keyup.enter)="search()"
          placeholder="Filter by event type..."
          class="search-input event-type-filter"
        />
        <button class="btn btn-primary" (click)="search()">Search</button>
        <button class="btn btn-secondary" (click)="clearSearch()">Clear</button>
      </div>
    </div>

    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <div *ngIf="isLoading" class="loading">Loading audit logs...</div>

    <div *ngIf="!isLoading && logs.length === 0" class="empty-state">
      {{ searchTerm || eventTypeFilter ? 'No logs match your filters.' : 'No audit logs found.' }}
    </div>

    <div *ngIf="!isLoading && logs.length > 0">
      <div class="pagination-info">{{ pageInfo }}</div>
      <table class="table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Event type</th>
            <th>User</th>
            <th>Email</th>
            <th>Event data</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of logs">
            <td class="col-timestamp">{{ formatTimestamp(getLogValue(log, 'eventTimestamp') ?? getLogValue(log, 'createdAt')) }}</td>
            <td>{{ getLogValue(log, 'eventType') || '-' }}</td>
            <td>{{ getLogValue(log, 'userName') || '-' }}</td>
            <td>{{ getLogValue(log, 'email') || '-' }}</td>
            <td class="col-event-data">{{ truncate(getLogValue(log, 'eventData'), 80) }}</td>
          </tr>
        </tbody>
      </table>
      <div class="pagination">
        <button class="btn btn-secondary" [disabled]="!hasPrevPage" (click)="prevPage()">Previous</button>
        <span class="pagination-text">{{ pageInfo }}</span>
        <button class="btn btn-secondary" [disabled]="!hasNextPage" (click)="nextPage()">Next</button>
      </div>
    </div>
  </div>
</div>
