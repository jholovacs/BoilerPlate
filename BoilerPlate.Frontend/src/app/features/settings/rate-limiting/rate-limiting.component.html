<div class="rate-limiting-page">
  <h1>Rate Limiting</h1>
  <p class="description">
    Configure rate limits for OAuth and JWT endpoints to prevent brute force and abuse.
    Limits are applied per IP address.
  </p>

  @if (errorMessage()) {
    <div class="alert alert-error" role="alert">{{ errorMessage() }}</div>
  }
  @if (successMessage()) {
    <div class="alert alert-success" role="alert">{{ successMessage() }}</div>
  }

  @if (isLoading()) {
    <p class="loading">Loading configurations...</p>
  } @else {
    <div class="config-list">
      @for (config of configs(); track config.endpointKey) {
        <div class="config-card">
          <div class="config-header">
            <h2>{{ config.displayName }}</h2>
            <span class="endpoint-key">{{ config.endpointKey }}</span>
          </div>
          <div class="config-form">
            <div class="form-group">
              <label [for]="'enabled-' + config.endpointKey">Enabled</label>
              <input
                type="checkbox"
                [id]="'enabled-' + config.endpointKey"
                [(ngModel)]="config.isEnabled"
              />
            </div>
            <div class="form-group">
              <label [for]="'permits-' + config.endpointKey">Requests per window</label>
              <input
                type="number"
                [id]="'permits-' + config.endpointKey"
                [(ngModel)]="config.permittedRequests"
                min="1"
                max="10000"
                class="input-number"
              />
            </div>
            <div class="form-group">
              <label [for]="'window-' + config.endpointKey">Window (seconds)</label>
              <input
                type="number"
                [id]="'window-' + config.endpointKey"
                [(ngModel)]="config.windowSeconds"
                min="1"
                max="3600"
                class="input-number"
              />
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn btn-primary"
                (click)="save(config)"
                [disabled]="savingEndpoint() === config.endpointKey"
              >
                @if (savingEndpoint() === config.endpointKey) {
                  Saving...
                } @else {
                  Save
                }
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
